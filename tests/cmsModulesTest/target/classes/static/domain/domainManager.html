<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>domain manager</title>
    <link rel="stylesheet" href="../css/mui.css"/>
    <script src="../js/Vue-2.2.js" type="text/javascript"></script>
    <script src="../js/axios-0.16.1.js" type="text/javascript"></script>
    <script src="../js/lodash-4.17.4.js" type="text/javascript"></script>
</head>
<body>
    <div id="domain-app">
        <header id="add-btn" class="mui-bar mui-bar-nav mui-bar-transparent">
            <h1 class="mui-title">标题</h1>
        </header>
        <nav class="mui-bar mui-bar-tab">
            <a class="mui-tab-item" href="#" v-on:click="switchDiv">
                <span class="mui-icon mui-icon-plusempty">{{addModuleBtnMsg}}</span>
            </a>
        </nav>
        <div class="mui-content">
            <ul id="data-list" v-if="showDomainList" class="mui-table-view">
                <li v-for="(item, index) in items" class="mui-table-view-cell mui-media">
                    <a href="javascript:;">

                        <img v-if="index % 2 == 0" class="mui-media-object mui-pull-left" src="../images/muwu.jpg">
                        <img v-else class="mui-media-object mui-pull-left" src="../images/shuijiao.jpg">

                        <div class="mui-media-body">
                            {{item.name}}-{{index}}
                            <p class='mui-ellipsis'>{{item.desc}}</p>
                        </div>
                    </a>
                </li>
            </ul>
            <div id="add-domain" v-if="showAddDomain">
                <form class="mui-input-group">
                    <div v-if="toastShown" class="mui-input-row" style="color:darkred;">
                        <label>添加失败</label>
                        <input type="text" v-model="toastMsg" class="mui-input-clear" readonly>
                    </div>
                    <div class="mui-input-row">
                        <label>域名</label>
                        <input type="text" v-model="moduleName" class="mui-input-clear" placeholder="请输入资源域名">
                    </div>
                    <div class="mui-input-row">
                        <label>描述</label>
                        <input type="text" v-model="moduleDesc" class="mui-input-clear" placeholder="请输入域名描述">
                    </div>
                    <div class="mui-button-row">
                        <button type="button" v-on:click="addModule" class="mui-btn mui-btn-primary" >添加</button>
                        <button type="button" v-on:click="resetForm" class="mui-btn mui-btn-danger" >重置</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

        var domFm = new Vue({
            el:'#domain-app',
            data:{
                moduleName:'',
                moduleDesc:'',
                toastMsg:'',
                addModuleBtnMsg:'添加',
                showDomainList:true,
                showAddDomain:false,
                toastShown:false,
                items:[]
            },
            beforeCreate:function(){
                var dm = this;
                axios.get('/getAllDomain').then(function(res){
                    var datas = res.data;
                    console.log(res);

                    dm.items = datas;
                }).catch(function(err){
                    console.log(err,'----error----')
                });
            },
            methods:{
                switchDiv:function(){
                    console.log('switchDiv','----switchDiv----')
                  if (this.showDomainList == true){
                    this.showDomainList = false;
                    this.showAddDomain  = true;
                    this.addModuleBtnMsg= '查看列表';
                  }else{
                      this.showDomainList = true;
                      this.showAddDomain  = false;
                      this.addModuleBtnMsg= '添加资源域';
                  }
                },
                reload2List:function(dm){
                    console.log('reload2List','----reload2List----')
                    //var dm = this;
                    axios.get('/getAllDomain').then(function(res){
                        var datas = res.data;
                        console.log(res,'------>result');
                        console.log(dm,'------>dm');
                        dm.items = datas;

                        this.showDomainList = true;
                        this.showAddDomain  = false;
                        this.addModuleBtnMsg= '添加资源域';
                    }).catch(function(err){
                        console.log(err,'----error----')
                    });
                },
                addModule:function (event) {
                    var dm = this;
                    if(dm.moduleName == ''){
                        console.log('名称不能为空.');
                        dm.toastShown = true;
                        dm.toastMsg = '名称不能为空';
                        return ;
                    }
                    if(dm.moduleDesc == ''){
                        console.log('资源域描述不能为空.');
                        dm.toastShown = true;
                        dm.toastMsg = '资源域描述不能为空';
                        return ;
                    }
                    var domainVo = {
                        name:dm.moduleName,
                        desc:dm.moduleDesc,
                        status:1
                    };
                    axios.post('/addDomain',domainVo).then(function(resp){
                        if (resp.status == 200){
                            //console.log(resp.data);
                            dm.toastShown = false;
                            dm.toastMsg = '添加成功';

                            dm.reload2List(dm);
                        }else{
                            dm.toastShown = true;
                            dm.toastMsg = '添加失败';
                        }
                    }).catch(function(err){
                        console.log(err,'----error----');
                        dm.toastShown = true;
                        dm.toastMsg = '添加失败';
                    });
                },
                resetForm:function (event) {
                    this.moduleDesc = '';
                    this.moduleName = '';
                    this.toastShown = false;
                    this.toastMsg = '';
                }
            }
        });

    </script>
</body>
</html>